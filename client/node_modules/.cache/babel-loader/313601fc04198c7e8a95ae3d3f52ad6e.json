{"ast":null,"code":"\"use strict\";\n\nvar Mexp = require('./math_function.js');\n\nfunction inc(arr, val) {\n  for (var i = 0; i < arr.length; i++) {\n    arr[i] += val;\n  }\n\n  return arr;\n}\n\nvar token = ['sin', 'cos', 'tan', 'pi', '(', ')', 'P', 'C', ' ', 'asin', 'acos', 'atan', '7', '8', '9', 'int', 'cosh', 'acosh', 'ln', '^', 'root', '4', '5', '6', '/', '!', 'tanh', 'atanh', 'Mod', '1', '2', '3', '*', 'sinh', 'asinh', 'e', 'log', '0', '.', '+', '-', ',', 'Sigma', 'n', 'Pi', 'pow'];\nvar show = ['sin', 'cos', 'tan', '&pi;', '(', ')', 'P', 'C', ' ', 'asin', 'acos', 'atan', '7', '8', '9', 'Int', 'cosh', 'acosh', ' ln', '^', 'root', '4', '5', '6', '&divide;', '!', 'tanh', 'atanh', ' Mod ', '1', '2', '3', '&times;', 'sinh', 'asinh', 'e', ' log', '0', '.', '+', '-', ',', '&Sigma;', 'n', '&Pi;', 'pow'];\nvar eva = [Mexp.math.sin, Mexp.math.cos, Mexp.math.tan, 'PI', '(', ')', Mexp.math.P, Mexp.math.C, ' '.anchor, Mexp.math.asin, Mexp.math.acos, Mexp.math.atan, '7', '8', '9', Math.floor, Mexp.math.cosh, Mexp.math.acosh, Math.log, Math.pow, Math.sqrt, '4', '5', '6', Mexp.math.div, Mexp.math.fact, Mexp.math.tanh, Mexp.math.atanh, Mexp.math.mod, '1', '2', '3', Mexp.math.mul, Mexp.math.sinh, Mexp.math.asinh, 'E', Mexp.math.log, '0', '.', Mexp.math.add, Mexp.math.sub, ',', Mexp.math.sigma, 'n', Mexp.math.Pi, Math.pow];\nvar preced = {\n  0: 11,\n  1: 0,\n  2: 3,\n  3: 0,\n  4: 0,\n  5: 0,\n  6: 0,\n  7: 11,\n  8: 11,\n  9: 1,\n  10: 10,\n  11: 0,\n  12: 11,\n  13: 0,\n  14: -1 // will be filtered after lexer\n\n}; // stores precedence by types\n\nvar type = [0, 0, 0, 3, 4, 5, 10, 10, 14, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 10, 0, 1, 1, 1, 2, 7, 0, 0, 2, 1, 1, 1, 2, 0, 0, 3, 0, 1, 6, 9, 9, 11, 12, 13, 12, 8];\n/*\r\n0 : function with syntax function_name(Maths_exp)\r\n1 : numbers\r\n2 : binary operators like * / Mod left associate and same precedence\r\n3 : Math constant values like e,pi,Cruncher ans\r\n4 : opening bracket\r\n5 : closing bracket\r\n6 : decimal\r\n7 : function with syntax (Math_exp)function_name\r\n8: function with syntax function_name(Math_exp1,Math_exp2)\r\n9 : binary operator like +,-\r\n10: binary operator like P C or ^\r\n11: ,\r\n12: function with , seperated three parameters and third parameter is a string that will be mexp string\r\n13: variable of Sigma function\r\n*/\n\nvar type0 = {\n  0: true,\n  1: true,\n  3: true,\n  4: true,\n  6: true,\n  8: true,\n  9: true,\n  12: true,\n  13: true,\n  14: true\n}; // type2:true,type4:true,type9:true,type11:true,type21:true,type22\n\nvar type1 = {\n  0: true,\n  1: true,\n  2: true,\n  3: true,\n  4: true,\n  5: true,\n  6: true,\n  7: true,\n  8: true,\n  9: true,\n  10: true,\n  11: true,\n  12: true,\n  13: true\n}; // type3:true,type5:true,type7:true,type23\n\nvar type1Asterick = {\n  0: true,\n  3: true,\n  4: true,\n  8: true,\n  12: true,\n  13: true\n};\nvar empty = {};\nvar type3Asterick = {\n  0: true,\n  1: true,\n  3: true,\n  4: true,\n  6: true,\n  8: true,\n  12: true,\n  13: true\n}; // type_5:true,type_7:true,type_23\n\nvar type6 = {\n  1: true\n};\nvar newAr = [[], ['1', '2', '3', '7', '8', '9', '4', '5', '6', '+', '-', '*', '/', '(', ')', '^', '!', 'P', 'C', 'e', '0', '.', ',', 'n', ' '], ['pi', 'ln', 'Pi'], ['sin', 'cos', 'tan', 'Del', 'int', 'Mod', 'log', 'pow'], ['asin', 'acos', 'atan', 'cosh', 'root', 'tanh', 'sinh'], ['acosh', 'atanh', 'asinh', 'Sigma']];\n\nfunction match(str1, str2, i, x) {\n  for (var f = 0; f < x; f++) {\n    if (str1[i + f] !== str2[f]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nMexp.addToken = function (tokens) {\n  for (var i = 0; i < tokens.length; i++) {\n    var x = tokens[i].token.length;\n    var temp = -1; // newAr is a specially designed data structure index of 1d array = length of tokens\n\n    newAr[x] = newAr[x] || [];\n\n    for (var y = 0; y < newAr[x].length; y++) {\n      if (tokens[i].token === newAr[x][y]) {\n        temp = token.indexOf(newAr[x][y]);\n        break;\n      }\n    }\n\n    if (temp === -1) {\n      token.push(tokens[i].token);\n      type.push(tokens[i].type);\n\n      if (newAr.length <= tokens[i].token.length) {\n        newAr[tokens[i].token.length] = [];\n      }\n\n      newAr[tokens[i].token.length].push(tokens[i].token);\n      eva.push(tokens[i].value);\n      show.push(tokens[i].show);\n    } else {\n      // overwrite\n      token[temp] = tokens[i].token;\n      type[temp] = tokens[i].type;\n      eva[temp] = tokens[i].value;\n      show[temp] = tokens[i].show;\n    }\n  }\n};\n\nfunction tokenize(string) {\n  var nodes = [];\n  var length = string.length;\n  var key, x, y;\n\n  for (var i = 0; i < length; i++) {\n    if (i < length - 1 && string[i] === ' ' && string[i + 1] === ' ') {\n      continue;\n    }\n\n    key = '';\n\n    for (x = string.length - i > newAr.length - 2 ? newAr.length - 1 : string.length - i; x > 0; x--) {\n      if (newAr[x] === undefined) continue;\n\n      for (y = 0; y < newAr[x].length; y++) {\n        if (match(string, newAr[x][y], i, x)) {\n          key = newAr[x][y];\n          y = newAr[x].length;\n          x = 0;\n        }\n      }\n    }\n\n    i += key.length - 1;\n\n    if (key === '') {\n      console.log(string, nodes);\n      throw new Mexp.Exception('Can\\'t understand after ' + string.slice(i));\n    }\n\n    var index = token.indexOf(key);\n    nodes.push({\n      index: index,\n      token: key,\n      type: type[index],\n      eval: eva[index],\n      precedence: preced[type[index]],\n      show: show[index]\n    });\n  }\n\n  return nodes;\n}\n\nMexp.lex = function (inp, tokens) {\n  'use strict';\n\n  var changeSignObj = {\n    value: Mexp.math.changeSign,\n    type: 0,\n    pre: 21,\n    show: '-'\n  };\n  var closingParObj = {\n    value: ')',\n    show: ')',\n    type: 5,\n    pre: 0\n  };\n  var openingParObj = {\n    value: '(',\n    type: 4,\n    pre: 0,\n    show: '('\n  };\n  var str = [openingParObj];\n  var ptc = []; // Parenthesis to close at the beginning is after one token\n\n  var inpStr = inp;\n  var allowed = type0;\n  var bracToClose = 0;\n  var asterick = empty;\n  var prevKey = '';\n  var i;\n\n  if (typeof tokens !== 'undefined') {\n    Mexp.addToken(tokens);\n  }\n\n  var obj = {};\n  var nodes = tokenize(inpStr);\n\n  for (i = 0; i < nodes.length; i++) {\n    var node = nodes[i];\n\n    if (node.type === 14) {\n      if (i > 0 && i < nodes.length - 1 && nodes[i + 1].type === 1 && (nodes[i - 1].type === 1 || nodes[i - 1].type === 6)) throw new Mexp.Exception('Unexpected Space');\n      continue;\n    }\n\n    var index = node.index;\n    var cToken = node.token;\n    var cType = node.type;\n    var cEv = node.eval;\n    var cPre = node.precedence;\n    var cShow = node.show;\n    var pre = str[str.length - 1];\n    var j;\n\n    for (j = ptc.length; j--;) {\n      // loop over ptc\n      if (ptc[j] === 0) {\n        if ([0, 2, 3, 4, 5, 9, 11, 12, 13].indexOf(cType) !== -1) {\n          if (allowed[cType] !== true) {\n            console.log(inp, node, nodes, allowed);\n            throw new Mexp.Exception(cToken + ' is not allowed after ' + prevKey);\n          }\n\n          str.push(closingParObj);\n          allowed = type1;\n          asterick = type3Asterick;\n          inc(ptc, -1).pop();\n        }\n      } else break;\n    }\n\n    if (allowed[cType] !== true) {\n      throw new Mexp.Exception(cToken + ' is not allowed after ' + prevKey);\n    }\n\n    if (asterick[cType] === true) {\n      cType = 2;\n      cEv = Mexp.math.mul;\n      cShow = '&times;';\n      cPre = 3;\n      i = i - cToken.length;\n    }\n\n    obj = {\n      value: cEv,\n      type: cType,\n      pre: cPre,\n      show: cShow\n    };\n\n    if (cType === 0) {\n      allowed = type0;\n      asterick = empty;\n      inc(ptc, 2).push(2);\n      str.push(obj);\n      str.push(openingParObj);\n    } else if (cType === 1) {\n      if (pre.type === 1) {\n        pre.value += cEv;\n        inc(ptc, 1);\n      } else {\n        str.push(obj);\n      }\n\n      allowed = type1;\n      asterick = type1Asterick;\n    } else if (cType === 2) {\n      allowed = type0;\n      asterick = empty;\n      inc(ptc, 2);\n      str.push(obj);\n    } else if (cType === 3) {\n      // constant\n      str.push(obj);\n      allowed = type1;\n      asterick = type3Asterick;\n    } else if (cType === 4) {\n      inc(ptc, 1);\n      bracToClose++;\n      allowed = type0;\n      asterick = empty;\n      str.push(obj);\n    } else if (cType === 5) {\n      if (!bracToClose) {\n        throw new Mexp.Exception('Closing parenthesis are more than opening one, wait What!!!');\n      }\n\n      bracToClose--;\n      allowed = type1;\n      asterick = type3Asterick;\n      str.push(obj);\n      inc(ptc, 1);\n    } else if (cType === 6) {\n      if (pre.hasDec) {\n        throw new Mexp.Exception('Two decimals are not allowed in one number');\n      }\n\n      if (pre.type !== 1) {\n        pre = {\n          value: 0,\n          type: 1,\n          pre: 0\n        }; // pre needs to be changed as it will the last value now to be safe in later code\n\n        str.push(pre);\n        inc(ptc, -1);\n      }\n\n      allowed = type6;\n      inc(ptc, 1);\n      asterick = empty;\n      pre.value += cEv;\n      pre.hasDec = true;\n    } else if (cType === 7) {\n      allowed = type1;\n      asterick = type3Asterick;\n      inc(ptc, 1);\n      str.push(obj);\n    }\n\n    if (cType === 8) {\n      allowed = type0;\n      asterick = empty;\n      inc(ptc, 4).push(4);\n      str.push(obj);\n      str.push(openingParObj);\n    } else if (cType === 9) {\n      if (pre.type === 9) {\n        if (pre.value === Mexp.math.add) {\n          pre.value = cEv;\n          pre.show = cShow;\n          inc(ptc, 1);\n        } else if (pre.value === Mexp.math.sub && cShow === '-') {\n          pre.value = Mexp.math.add;\n          pre.show = '+';\n          inc(ptc, 1);\n        }\n      } else if (pre.type !== 5 && pre.type !== 7 && pre.type !== 1 && pre.type !== 3 && pre.type !== 13) {\n        // changesign only when negative is found\n        if (cToken === '-') {\n          // do nothing for + token\n          // don't add with the above if statement as that will run the else statement of parent if on Ctoken +\n          allowed = type0;\n          asterick = empty;\n          inc(ptc, 2).push(2);\n          str.push(changeSignObj);\n          str.push(openingParObj);\n        }\n      } else {\n        str.push(obj);\n        inc(ptc, 2);\n      }\n\n      allowed = type0;\n      asterick = empty;\n    } else if (cType === 10) {\n      allowed = type0;\n      asterick = empty;\n      inc(ptc, 2);\n      str.push(obj);\n    } else if (cType === 11) {\n      allowed = type0;\n      asterick = empty;\n      str.push(obj);\n    } else if (cType === 12) {\n      allowed = type0;\n      asterick = empty;\n      inc(ptc, 6).push(6);\n      str.push(obj);\n      str.push(openingParObj);\n    } else if (cType === 13) {\n      allowed = type1;\n      asterick = type3Asterick;\n      str.push(obj);\n    }\n\n    inc(ptc, -1);\n    prevKey = cToken;\n  }\n\n  for (j = ptc.length; j--;) {\n    // loop over ptc\n    if (ptc[j] === 0) {\n      str.push(closingParObj);\n      inc(ptc, -1).pop();\n    } else break; // if it is not zero so before ptc also cant be zero\n\n  }\n\n  if (allowed[5] !== true) {\n    throw new Mexp.Exception('complete the expression');\n  }\n\n  while (bracToClose--) {\n    str.push(closingParObj);\n  }\n\n  str.push(closingParObj); //        console.log(str);\n\n  return new Mexp(str);\n};\n\nmodule.exports = Mexp;","map":{"version":3,"sources":["/Users/tantelyrabefarihy/Documents/CODING/concordia-bootcamps/final-project-covid-tracker/covid-app/node_modules/math-expression-evaluator/src/lexer.js"],"names":["Mexp","require","inc","arr","val","i","length","token","show","eva","math","sin","cos","tan","P","C","anchor","asin","acos","atan","Math","floor","cosh","acosh","log","pow","sqrt","div","fact","tanh","atanh","mod","mul","sinh","asinh","add","sub","sigma","Pi","preced","type","type0","type1","type1Asterick","empty","type3Asterick","type6","newAr","match","str1","str2","x","f","addToken","tokens","temp","y","indexOf","push","value","tokenize","string","nodes","key","undefined","console","Exception","slice","index","eval","precedence","lex","inp","changeSignObj","changeSign","pre","closingParObj","openingParObj","str","ptc","inpStr","allowed","bracToClose","asterick","prevKey","obj","node","cToken","cType","cEv","cPre","cShow","j","pop","hasDec","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar Mexp = require('./math_function.js')\r\nfunction inc(arr, val) {\r\n  for (var i = 0; i < arr.length; i++) {\r\n    arr[i] += val\r\n  }\r\n  return arr\r\n}\r\nvar token = ['sin', 'cos', 'tan', 'pi', '(', ')', 'P', 'C', ' ',\r\n  'asin', 'acos', 'atan', '7', '8', '9', 'int',\r\n  'cosh', 'acosh', 'ln', '^', 'root', '4', '5', '6', '/', '!',\r\n  'tanh', 'atanh', 'Mod', '1', '2', '3', '*',\r\n  'sinh', 'asinh', 'e', 'log', '0', '.', '+', '-', ',', 'Sigma', 'n', 'Pi', 'pow']\r\nvar show = ['sin', 'cos', 'tan', '&pi;', '(', ')', 'P', 'C', ' ',\r\n  'asin', 'acos', 'atan', '7', '8', '9', 'Int',\r\n  'cosh', 'acosh', ' ln', '^', 'root', '4', '5', '6', '&divide;', '!',\r\n  'tanh', 'atanh', ' Mod ', '1', '2', '3', '&times;',\r\n  'sinh', 'asinh', 'e', ' log', '0', '.', '+', '-', ',', '&Sigma;', 'n', '&Pi;', 'pow']\r\nvar eva = [Mexp.math.sin, Mexp.math.cos, Mexp.math.tan, 'PI', '(', ')', Mexp.math.P, Mexp.math.C, ' '.anchor,\r\nMexp.math.asin, Mexp.math.acos, Mexp.math.atan, '7', '8', '9', Math.floor,\r\nMexp.math.cosh, Mexp.math.acosh, Math.log, Math.pow, Math.sqrt, '4', '5', '6', Mexp.math.div, Mexp.math.fact,\r\nMexp.math.tanh, Mexp.math.atanh, Mexp.math.mod, '1', '2', '3', Mexp.math.mul,\r\nMexp.math.sinh, Mexp.math.asinh, 'E', Mexp.math.log, '0', '.', Mexp.math.add, Mexp.math.sub, ',', Mexp.math.sigma, 'n', Mexp.math.Pi, Math.pow]\r\nvar preced = {\r\n  0: 11,\r\n  1: 0,\r\n  2: 3,\r\n  3: 0,\r\n  4: 0,\r\n  5: 0,\r\n  6: 0,\r\n  7: 11,\r\n  8: 11,\r\n  9: 1,\r\n  10: 10,\r\n  11: 0,\r\n  12: 11,\r\n  13: 0,\r\n  14: -1 // will be filtered after lexer\r\n} // stores precedence by types\r\nvar type = [0, 0, 0, 3, 4, 5, 10, 10, 14,\r\n  0, 0, 0, 1, 1, 1, 0,\r\n  0, 0, 0, 10, 0, 1, 1, 1, 2, 7,\r\n  0, 0, 2, 1, 1, 1, 2,\r\n  0, 0, 3, 0, 1, 6, 9, 9, 11, 12, 13, 12, 8]\r\n/*\r\n0 : function with syntax function_name(Maths_exp)\r\n1 : numbers\r\n2 : binary operators like * / Mod left associate and same precedence\r\n3 : Math constant values like e,pi,Cruncher ans\r\n4 : opening bracket\r\n5 : closing bracket\r\n6 : decimal\r\n7 : function with syntax (Math_exp)function_name\r\n8: function with syntax function_name(Math_exp1,Math_exp2)\r\n9 : binary operator like +,-\r\n10: binary operator like P C or ^\r\n11: ,\r\n12: function with , seperated three parameters and third parameter is a string that will be mexp string\r\n13: variable of Sigma function\r\n*/\r\nvar type0 = {\r\n  0: true,\r\n  1: true,\r\n  3: true,\r\n  4: true,\r\n  6: true,\r\n  8: true,\r\n  9: true,\r\n  12: true,\r\n  13: true,\r\n  14: true\r\n} // type2:true,type4:true,type9:true,type11:true,type21:true,type22\r\nvar type1 = {\r\n  0: true,\r\n  1: true,\r\n  2: true,\r\n  3: true,\r\n  4: true,\r\n  5: true,\r\n  6: true,\r\n  7: true,\r\n  8: true,\r\n  9: true,\r\n  10: true,\r\n  11: true,\r\n  12: true,\r\n  13: true\r\n} // type3:true,type5:true,type7:true,type23\r\nvar type1Asterick = {\r\n  0: true,\r\n  3: true,\r\n  4: true,\r\n  8: true,\r\n  12: true,\r\n  13: true\r\n}\r\nvar empty = {}\r\nvar type3Asterick = {\r\n  0: true,\r\n  1: true,\r\n  3: true,\r\n  4: true,\r\n  6: true,\r\n  8: true,\r\n  12: true,\r\n  13: true\r\n} // type_5:true,type_7:true,type_23\r\nvar type6 = {\r\n  1: true\r\n}\r\nvar newAr = [\r\n  [],\r\n  ['1', '2', '3', '7', '8', '9', '4', '5', '6', '+', '-', '*', '/', '(', ')', '^', '!', 'P', 'C', 'e', '0', '.', ',', 'n', ' '],\r\n  ['pi', 'ln', 'Pi'],\r\n  ['sin', 'cos', 'tan', 'Del', 'int', 'Mod', 'log', 'pow'],\r\n  ['asin', 'acos', 'atan', 'cosh', 'root', 'tanh', 'sinh'],\r\n  ['acosh', 'atanh', 'asinh', 'Sigma']\r\n]\r\n\r\nfunction match(str1, str2, i, x) {\r\n  for (var f = 0; f < x; f++) {\r\n    if (str1[i + f] !== str2[f]) {\r\n      return false\r\n    }\r\n  }\r\n  return true\r\n}\r\nMexp.addToken = function (tokens) {\r\n  for (var i = 0; i < tokens.length; i++) {\r\n    var x = tokens[i].token.length\r\n    var temp = -1\r\n\r\n    // newAr is a specially designed data structure index of 1d array = length of tokens\r\n    newAr[x] = newAr[x] || [];\r\n    for (var y = 0; y < newAr[x].length; y++) {\r\n      if (tokens[i].token === newAr[x][y]) {\r\n        temp = token.indexOf(newAr[x][y])\r\n        break\r\n      }\r\n    }\r\n    if (temp === -1) {\r\n      token.push(tokens[i].token)\r\n      type.push(tokens[i].type)\r\n      if (newAr.length <= tokens[i].token.length) {\r\n        newAr[tokens[i].token.length] = []\r\n      }\r\n      newAr[tokens[i].token.length].push(tokens[i].token)\r\n      eva.push(tokens[i].value)\r\n      show.push(tokens[i].show)\r\n    } else { // overwrite\r\n      token[temp] = tokens[i].token\r\n      type[temp] = tokens[i].type\r\n      eva[temp] = tokens[i].value\r\n      show[temp] = tokens[i].show\r\n    }\r\n  }\r\n}\r\n\r\nfunction tokenize(string) {\r\n  var nodes = [];\r\n  var length = string.length;\r\n  var key, x, y;\r\n  for (var i = 0; i < length; i++) {\r\n    if (i < length - 1 && string[i] === ' ' && string[i + 1] === ' ') {\r\n      continue\r\n    }\r\n    key = ''\r\n    for (x = (string.length - i > (newAr.length - 2) ? newAr.length - 1 : string.length - i); x > 0; x--) {\r\n      if (newAr[x] === undefined) continue;\r\n      for (y = 0; y < newAr[x].length; y++) {\r\n        if (match(string, newAr[x][y], i, x)) {\r\n          key = newAr[x][y]\r\n          y = newAr[x].length\r\n          x = 0\r\n        }\r\n      }\r\n    }\r\n    i += key.length - 1\r\n    if (key === '') {\r\n      console.log(string, nodes)\r\n      throw (new Mexp.Exception('Can\\'t understand after ' + string.slice(i)))\r\n    }\r\n    var index = token.indexOf(key);\r\n    nodes.push({\r\n      index: index,\r\n      token: key,\r\n      type: type[index],\r\n      eval: eva[index],\r\n      precedence: preced[type[index]],\r\n      show: show[index]\r\n    })\r\n  }\r\n  return nodes;\r\n}\r\n\r\nMexp.lex = function (inp, tokens) {\r\n  'use strict'\r\n\r\n\r\n  var changeSignObj = {\r\n    value: Mexp.math.changeSign,\r\n    type: 0,\r\n    pre: 21,\r\n    show: '-'\r\n  }\r\n  var closingParObj = {\r\n    value: ')',\r\n    show: ')',\r\n    type: 5,\r\n    pre: 0\r\n  }\r\n  var openingParObj = {\r\n    value: '(',\r\n    type: 4,\r\n    pre: 0,\r\n    show: '('\r\n  }\r\n  var str = [openingParObj]\r\n\r\n  var ptc = [] // Parenthesis to close at the beginning is after one token\r\n  var inpStr = inp\r\n  var allowed = type0\r\n  var bracToClose = 0\r\n  var asterick = empty\r\n  var prevKey = ''\r\n  var i;\r\n  if (typeof tokens !== 'undefined') {\r\n    Mexp.addToken(tokens)\r\n  }\r\n  var obj = {}\r\n  var nodes = tokenize(inpStr);\r\n  for (i = 0; i < nodes.length; i++) {\r\n    var node = nodes[i];\r\n    if (node.type === 14) {\r\n      if (i > 0 &&\r\n        i < nodes.length - 1 &&\r\n        nodes[i + 1].type === 1 &&\r\n        (nodes[i - 1].type === 1 || nodes[i - 1].type === 6))\r\n        throw new Mexp.Exception('Unexpected Space')\r\n      continue\r\n    }\r\n\r\n    var index = node.index\r\n    var cToken = node.token\r\n    var cType = node.type\r\n    var cEv = node.eval\r\n    var cPre = node.precedence\r\n    var cShow = node.show\r\n    var pre = str[str.length - 1]\r\n    var j\r\n    for (j = ptc.length; j--;) { // loop over ptc\r\n      if (ptc[j] === 0) {\r\n        if ([0, 2, 3, 4, 5, 9, 11, 12, 13].indexOf(cType) !== -1) {\r\n          if (allowed[cType] !== true) {\r\n            console.log(inp, node, nodes, allowed)\r\n            throw (new Mexp.Exception(cToken + ' is not allowed after ' + prevKey))\r\n          }\r\n          str.push(closingParObj)\r\n          allowed = type1\r\n          asterick = type3Asterick\r\n          inc(ptc, -1).pop()\r\n        }\r\n      } else break\r\n    }\r\n    if (allowed[cType] !== true) {\r\n      throw (new Mexp.Exception(cToken + ' is not allowed after ' + prevKey))\r\n    }\r\n    if (asterick[cType] === true) {\r\n      cType = 2\r\n      cEv = Mexp.math.mul\r\n      cShow = '&times;'\r\n      cPre = 3\r\n      i = i - cToken.length\r\n    }\r\n    obj = {\r\n      value: cEv,\r\n      type: cType,\r\n      pre: cPre,\r\n      show: cShow\r\n    }\r\n    if (cType === 0) {\r\n      allowed = type0\r\n      asterick = empty\r\n      inc(ptc, 2).push(2)\r\n      str.push(obj)\r\n      str.push(openingParObj)\r\n    } else if (cType === 1) {\r\n      if (pre.type === 1) {\r\n        pre.value += cEv\r\n        inc(ptc, 1)\r\n      } else {\r\n        str.push(obj)\r\n      }\r\n      allowed = type1\r\n      asterick = type1Asterick\r\n    } else if (cType === 2) {\r\n      allowed = type0\r\n      asterick = empty\r\n      inc(ptc, 2)\r\n      str.push(obj)\r\n    } else if (cType === 3) { // constant\r\n      str.push(obj)\r\n      allowed = type1\r\n      asterick = type3Asterick\r\n    } else if (cType === 4) {\r\n      inc(ptc, 1)\r\n      bracToClose++\r\n      allowed = type0\r\n      asterick = empty\r\n      str.push(obj)\r\n    } else if (cType === 5) {\r\n      if (!bracToClose) {\r\n        throw (new Mexp.Exception('Closing parenthesis are more than opening one, wait What!!!'))\r\n      }\r\n      bracToClose--\r\n      allowed = type1\r\n      asterick = type3Asterick\r\n      str.push(obj)\r\n      inc(ptc, 1)\r\n    } else if (cType === 6) {\r\n      if (pre.hasDec) {\r\n        throw (new Mexp.Exception('Two decimals are not allowed in one number'))\r\n      }\r\n      if (pre.type !== 1) {\r\n        pre = {\r\n          value: 0,\r\n          type: 1,\r\n          pre: 0\r\n        } // pre needs to be changed as it will the last value now to be safe in later code\r\n        str.push(pre)\r\n        inc(ptc, -1)\r\n      }\r\n      allowed = type6\r\n      inc(ptc, 1)\r\n      asterick = empty\r\n      pre.value += cEv\r\n      pre.hasDec = true\r\n    } else if (cType === 7) {\r\n      allowed = type1\r\n      asterick = type3Asterick\r\n      inc(ptc, 1)\r\n      str.push(obj)\r\n    }\r\n    if (cType === 8) {\r\n      allowed = type0\r\n      asterick = empty\r\n      inc(ptc, 4).push(4)\r\n      str.push(obj)\r\n      str.push(openingParObj)\r\n    } else if (cType === 9) {\r\n      if (pre.type === 9) {\r\n        if (pre.value === Mexp.math.add) {\r\n          pre.value = cEv\r\n          pre.show = cShow\r\n          inc(ptc, 1)\r\n        } else if (pre.value === Mexp.math.sub && cShow === '-') {\r\n          pre.value = Mexp.math.add\r\n          pre.show = '+'\r\n          inc(ptc, 1)\r\n        }\r\n      } else if (pre.type !== 5 && pre.type !== 7 && pre.type !== 1 && pre.type !== 3 && pre.type !== 13) { // changesign only when negative is found\r\n        if (cToken === '-') { // do nothing for + token\r\n          // don't add with the above if statement as that will run the else statement of parent if on Ctoken +\r\n          allowed = type0\r\n          asterick = empty\r\n          inc(ptc, 2).push(2)\r\n          str.push(changeSignObj)\r\n          str.push(openingParObj)\r\n        }\r\n      } else {\r\n        str.push(obj)\r\n        inc(ptc, 2)\r\n      }\r\n      allowed = type0\r\n      asterick = empty\r\n    } else if (cType === 10) {\r\n      allowed = type0\r\n      asterick = empty\r\n      inc(ptc, 2)\r\n      str.push(obj)\r\n    } else if (cType === 11) {\r\n      allowed = type0\r\n      asterick = empty\r\n      str.push(obj)\r\n    } else if (cType === 12) {\r\n      allowed = type0\r\n      asterick = empty\r\n      inc(ptc, 6).push(6)\r\n      str.push(obj)\r\n      str.push(openingParObj)\r\n    } else if (cType === 13) {\r\n      allowed = type1\r\n      asterick = type3Asterick\r\n      str.push(obj)\r\n    }\r\n    inc(ptc, -1)\r\n    prevKey = cToken\r\n  }\r\n  for (j = ptc.length; j--;) { // loop over ptc\r\n    if (ptc[j] === 0) {\r\n      str.push(closingParObj)\r\n      inc(ptc, -1).pop()\r\n    } else break  // if it is not zero so before ptc also cant be zero\r\n  }\r\n  if (allowed[5] !== true) {\r\n    throw (new Mexp.Exception('complete the expression'))\r\n  }\r\n  while (bracToClose--) {\r\n    str.push(closingParObj)\r\n  }\r\n\r\n  str.push(closingParObj)\r\n  //        console.log(str);\r\n  return new Mexp(str)\r\n}\r\nmodule.exports = Mexp\r\n"]},"metadata":{},"sourceType":"script"}